FROM node:9.11.2

# Also exposing VSCode debug ports
# EXPOSE 8000 9929 9230

RUN apt-get update && apt-get install -y python virtualenv python-dev python-setuptools
RUN easy_install pip
WORKDIR /app
RUN virtualenv venv
RUN . venv/bin/activate
COPY ./requirements*.txt ./
COPY ./setup.* ./
RUN pip install -r requirements.txt
RUN pip install -r requirements_for_test.txt

# RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.1/install.sh | bash
# RUN export NVM_DIR="$HOME/.nvm" \
# [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  \ 
# [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion" 
# RUN nvm install 9.11.2
# RUN nvm use 9.11.2

COPY ./package* ./
COPY ./gulpfile* ./
# RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.1/install.sh | bash
# RUN . ~/.nvm/nvm.sh
# RUN nvm install 9.11.2
# RUN nvm use 9.11.2
RUN npm install
RUN npm run frontend-build:development

# COPY . .

# RUN mkdir src
VOLUME /app

ENTRYPOINT ["make", "run_app"]
